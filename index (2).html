<!DOCTYPE html>
<html lang="ml">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Asma's Vehicle Pro Manager</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<style>
:root { --primary: #1e3799; --bg: #f4f7f6; --danger: #eb4d4b; --warning: #f1c40f; --dark: #2d3436; --success: #2ecc71; }
body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding-bottom: 50px; }

.header { background: linear-gradient(135deg, #1e3799, #0c2461); color: white; padding: 25px 20px 60px; text-align: center; }

.settings-panel { background: #fff; margin: -30px 15px 15px; border-radius: 15px; padding: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); display: flex; gap: 10px; position: relative; z-index: 1000; }
.st-btn { flex: 1; padding: 10px; border-radius: 8px; border: 1.5px solid #eee; background: #fff; font-size: 11px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 5px; color: var(--dark); }

.container { padding: 0 15px; }
.form-card { background: white; padding: 20px; border-radius: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); margin-bottom: 25px; }

.upload-row { display: flex; gap: 10px; margin-bottom: 15px; }
.up-box { flex: 1; background: #f0f4ff; border: 1.5px dashed #1e3799; padding: 12px; border-radius: 12px; text-align: center; cursor: pointer; }
.up-box i { font-size: 18px; color: var(--primary); display: block; margin-bottom: 5px; }
.up-box span { font-size: 10px; font-weight: bold; color: var(--primary); }

input { width: 100%; padding: 12px; margin-bottom: 10px; border: 1.5px solid #eee; border-radius: 10px; box-sizing: border-box; outline: none; }
.grid-dates { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
label { font-size: 10px; font-weight: bold; color: #666; display: block; margin-bottom: 3px; }

/* List Items */
.v-list-item { background: white; padding: 15px; border-radius: 20px; margin-bottom: 15px; border-left: 8px solid #ddd; box-shadow: 0 4px 10px rgba(0,0,0,0.03); display: flex; gap: 12px; }
.v-thumb { width: 65px; height: 65px; border-radius: 12px; object-fit: cover; background: #eee; }
.v-info { flex: 1; }

.dash-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; margin-top: 10px; }
.dash-box { font-size: 8px; padding: 6px 2px; border-radius: 6px; text-align: center; font-weight: bold; background: #f8f9fa; border: 1px solid #eee; }
.st-expired { background: #ffebeb !important; color: #d63031 !important; }
.st-due { background: #fff9e6 !important; color: #856404 !important; }

.act-btn { flex: 1; border: none; padding: 12px; border-radius: 12px; font-weight: bold; font-size: 11px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 6px; }
.share-btn { background: var(--primary); color: white; }
.wa-btn { background: var(--success); color: white; text-decoration: none; }

/* Perfect Center Card Overlay */
#shareOverlay { display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.95); z-index: 10000; }
.premium-card { background: white; width: 90%; max-width: 350px; border-radius: 25px; overflow: hidden; text-align: center; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); box-shadow: 0 20px 50px rgba(0,0,0,0.5); }

.p-vno-bar { background: var(--primary); color: white; padding: 20px 10px 5px; font-size: 26px; font-weight: bold; }
.p-name-bar { background: var(--primary); color: #c3cfe2; padding: 0 10px 15px; font-size: 14px; font-weight: bold; text-transform: uppercase; }
.p-banner-area { width: 100%; height: 140px; background: #222; position: relative; }
.p-v-photo { width: 85px; height: 85px; border: 4px solid white; border-radius: 50%; position: absolute; bottom: -42px; left: 50%; transform: translateX(-50%); object-fit: cover; background: #fff; z-index: 5; }
.p-body { padding: 50px 15px 25px; }

.card-alert-box { background: #fff5f5; border: 1px solid #feb2b2; border-radius: 12px; padding: 10px; margin-bottom: 12px; text-align: left; }
.alert-item { color: #c53030; font-size: 12px; font-weight: bold; display: block; border-bottom: 1px dashed #ffdada; padding: 3px 0; }
.ad-box { background: #f0f7ff; border: 1.5px solid #bee3f8; padding: 15px; border-radius: 20px; }
</style>
</head>
<body>

<div class="header"><h2>Asma's Vehicle Manager</h2></div>

<div class="settings-panel">
<div class="st-btn" onclick="exportData()"><i class="fas fa-file-download"></i> BACKUP</div>
<div class="st-btn" onclick="document.getElementById('impFile').click()"><i class="fas fa-file-upload"></i> RESTORE</div>
<input type="file" id="impFile" hidden onchange="importData(this)">
</div>

<div class="container">
<div class="form-card">
<input type="hidden" id="editId">
<div class="upload-row">
<div class="up-box" onclick="document.getElementById('bgInp').click()">
<i class="fas fa-image"></i><span>BANNER BG</span>
<input type="file" id="bgInp" hidden onchange="processImg(this, 'banner')">
</div>
<div class="up-box" onclick="document.getElementById('vImgInp').click()">
<i class="fas fa-camera"></i><span>VEHICLE IMG</span>
<input type="file" id="vImgInp" hidden onchange="processImg(this, 'vehicle')">
</div>
</div>
<input type="text" id="vNo" placeholder="Vehicle Number">
<input type="text" id="oName" placeholder="Owner Name">
<input type="tel" id="oPhone" placeholder="WhatsApp Number">
<div class="grid-dates">
<div><label>Insurance</label><input type="date" id="ins"></div>
<div><label>Tax</label><input type="date" id="tax"></div>
<div><label>Pollution</label><input type="date" id="pol"></div>
<div><label>Fitness</label><input type="date" id="fit"></div>
<div><label>Renewal</label><input type="date" id="ren"></div>
<div><label>Welfare</label><input type="date" id="wel"></div>
</div>
<button id="saveBtn" class="act-btn share-btn" style="width:100%; margin-top:15px;" onclick="saveData()">SAVE VEHICLE</button>
</div>
<div id="displayArea"></div>
</div>

<div id="shareOverlay" onclick="this.style.display='none'">
<div class="premium-card" onclick="event.stopPropagation()">
<div class="p-vno-bar" id="p_vNo"></div>
<div class="p-name-bar" id="p_oName"></div>
<div class="p-banner-area">
<img id="p_banner" style="width:100%; height:100%; object-fit:cover;">
<img id="p_vimg" class="p-v-photo">
</div>
<div class="p-body">
<div id="p_alerts"></div>
<div class="ad-box">
<div style="color:var(--primary); font-weight:900; font-size:15px;">ASMA'S VEHICLE RELATED SERVICE</div>
<div style="font-size:11px; font-weight:bold; color:#4a5568; margin-top:5px;">വാഹന സംബന്ധമായ എല്ലാ പേപ്പർ വർക്കുകളും ഉത്തരവാദിത്തത്തോടുകൂടി ഞങ്ങൾ ചെയ്തു കൊടുക്കുന്നു</div>
<div style="font-size:18px; font-weight:900; color:#1a365d; margin-top:10px;">9037531655, 7012496868</div>
</div>
</div>
</div>
</div>

<script>
let currentVImg = "";
const malMapping = { "Insurance":"ഇൻഷുറൻസ്", "Tax":"ടാക്സ്", "Pollution":"പുക", "Fitness":"ഫിറ്റ്നസ്", "Renewal":"റിന്യൂവൽ", "Welfare":"വെൽഫെയർ" };

function processImg(input, type) {
const reader = new FileReader();
reader.onload = function(e) {
if(type === 'banner') { localStorage.setItem('asma_banner', e.target.result); alert("Banner Saved!"); }
else { currentVImg = e.target.result; alert("Vehicle Photo Ready!"); }
};
reader.readAsDataURL(input.files[0]);
}

function getStatus(dateStr) {
if(!dateStr) return 9999;
return Math.ceil((new Date(dateStr) - new Date().setHours(0,0,0,0)) / 86400000);
}

function saveData() {
const id = document.getElementById('editId').value;
const vehicle = {
id: id ? parseInt(id) : Date.now(),
vNo: document.getElementById('vNo').value.toUpperCase(),
name: document.getElementById('oName').value,
phone: document.getElementById('oPhone').value,
vImg: currentVImg,
dates: { "Insurance": document.getElementById('ins').value, "Tax": document.getElementById('tax').value, "Pollution": document.getElementById('pol').value, "Fitness": document.getElementById('fit').value, "Renewal": document.getElementById('ren').value, "Welfare": document.getElementById('wel').value }
};
let list = JSON.parse(localStorage.getItem('vData') || '[]');
if(id) {
const idx = list.findIndex(v => v.id === vehicle.id);
if(!currentVImg) vehicle.vImg = list[idx].vImg;
list[idx] = vehicle;
} else list.unshift(vehicle);
localStorage.setItem('vData', JSON.stringify(list));
location.reload();
}

function loadData() {
let list = JSON.parse(localStorage.getItem('vData') || '[]');
const area = document.getElementById('displayArea'); area.innerHTML = '';
list.forEach(item => {
let boxes = "";
for(let s in item.dates) {
if(item.dates[s]) {
const diff = getStatus(item.dates[s]);
const cls = diff < 0 ? 'st-expired' : (diff <= 15 ? 'st-due' : '');
boxes += `<div class="dash-box ${cls}">${s}<br>${item.dates[s].split('-').reverse().join('/')}</div>`;
}
}
area.innerHTML += `<div class="v-list-item">
<img src="${item.vImg || 'https://via.placeholder.com/65'}" class="v-thumb">
<div class="v-info">
<div style="display:flex; justify-content:space-between"><b>${item.vNo}</b>
<div><i class="fas fa-edit" style="color:#aaa;margin-right:15px" onclick="editItem(${item.id})"></i>
<i class="fas fa-trash" style="color:red" onclick="deleteItem(${item.id})"></i></div></div>
<div style="font-size:11px;color:grey">${item.name}</div>
<div class="dash-grid">${boxes}</div>
<div style="display:flex; gap:8px; margin-top:10px;">
<button class="act-btn share-btn" onclick="showCard(${item.id})">CARD</button>
<a href="https://wa.me/${item.phone}" class="act-btn wa-btn">WhatsApp</a>
</div>
</div>
</div>`;
});
}

function showCard(id) {
const v = JSON.parse(localStorage.getItem('vData')).find(i => i.id === id);
document.getElementById('p_vNo').innerText = v.vNo;
document.getElementById('p_oName').innerText = v.name;
document.getElementById('p_banner').src = localStorage.getItem('asma_banner') || "";
document.getElementById('p_vimg').src = v.vImg || "https://via.placeholder.com/90";

let alertHTML = "";
let hasAlert = false;
for(let s in v.dates) {
if(v.dates[s]) {
const diff = getStatus(v.dates[s]);
if(diff <= 25) {
hasAlert = true;
const msg = diff < 0 ? "കാലാവധി കഴിഞ്ഞു" : "കാലാവധി തീരാറായി";
alertHTML += `<span class="alert-item">⚠️ ${malMapping[s]} ${msg}: ${v.dates[s].split('-').reverse().join('/')}</span>`;
}
}
}
document.getElementById('p_alerts').innerHTML = hasAlert ? `<div class="card-alert-box">${alertHTML}</div>` : "";
document.getElementById('shareOverlay').style.display = 'block';
}

function editItem(id) {
const v = JSON.parse(localStorage.getItem('vData')).find(i => i.id === id);
document.getElementById('editId').value = v.id;
document.getElementById('vNo').value = v.vNo;
document.getElementById('oName').value = v.name;
document.getElementById('oPhone').value = v.phone;
document.getElementById('ins').value = v.dates["Insurance"] || "";
document.getElementById('tax').value = v.dates["Tax"] || "";
document.getElementById('pol').value = v.dates["Pollution"] || "";
document.getElementById('fit').value = v.dates["Fitness"] || "";
document.getElementById('ren').value = v.dates["Renewal"] || "";
document.getElementById('wel').value = v.dates["Welfare"] || "";
currentVImg = v.vImg;
window.scrollTo(0,0);
}

function deleteItem(id) { if(confirm("Delete?")) {
let list = JSON.parse(localStorage.getItem('vData')).filter(v => v.id !== id);
localStorage.setItem('vData', JSON.stringify(list)); loadData();
}}
function exportData() {
const blob = new Blob([localStorage.getItem('vData')], {type:'application/json'});
const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `Asma_Backup.json`; a.click();
}
function importData(input) {
const reader = new FileReader(); reader.onload = () => { localStorage.setItem('vData', reader.result); location.reload(); }; reader.readAsText(input.files[0]);
}
document.addEventListener('DOMContentLoaded', loadData);
</script>
</body>
</html>